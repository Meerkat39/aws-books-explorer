# SAM（AWS Serverless Application Model）学習メモ

## 📅 学習日時

2025 年 11 月 23 日

## ✅ 結論

SAM はサーバーレス向けの IaC（CloudFormation の拡張）で、Lambda + API Gateway を宣言的に定義・デプロイできる。ローカルでの動作確認（`sam local`）は Docker が必要だが、今回は Docker を使わずにまずテンプレート作成→`sam deploy` でデプロイする流れを学ぶのが効率的。

## 🧠 詳細

- 目的: `backend/lambda` にある Node.js ハンドラを SAM でパッケージング・デプロイするための学習。今回の方針は **Docker を使わない**（ローカルエミュレーションは別途学ぶ）。
- 前提:
  - AWS アカウントと適切なアクセス権（デプロイに使う AWS プロファイル）
  - SAM CLI と AWS CLI がインストールされていること（Docker は今回は不要）
  - デプロイ先リージョン（例: `ap-northeast-1`）を決める

- 重要なコマンド（参考）:
  - `sam --version`（動作確認）
  - `sam build`（ビルド）
  - `sam deploy --guided`（初回デプロイ。スタック名・S3 バケット等を対話で設定）

- 実行手順（今回の最小フロー）:
  1. 新しいブランチを作成（例: `feat/sam-deploy`）。
     ```bash
     git checkout -b feat/sam-deploy
     ```
  2. プロジェクトルートに `template.yaml`（SAM テンプレート）を作成する。テンプレートには Lambda のハンドラのパス、ランタイム、Events(Api) を定義する。
  3. ビルド（必要なら）:
     ```bash
     sam build
     ```
  4. デプロイ（初回）:
     ```bash
     sam deploy --guided
     ```
     - 対話で入力する値はスタック名、デプロイするリージョン、S3 バケット（アーティファクト保管）など。`samconfig.toml` が作成され、次回以降は `sam deploy` で再利用できる。

- Docker を使わない場合の注意点:
  - `sam local` によるローカル実行は使えない（そのためローカルでのエミュレーションは行わない）。
  - Node 単体のハンドラであれば、本番環境で動く可能性は高いが、ネイティブモジュールを使う場合や本番環境と同等の検証が必要な場合はあとで Docker を導入して `sam local` や `sam build --use-container` を試す。

- 環境変数（APIキー）の扱い（学習上のベストプラクティス）:
  - 開発用は `.env`（ローカル）で管理（`.gitignore` に含める）。今回の学習では既に `.env` を利用している。
  - 本番デプロイ時は `AWS Secrets Manager` または `SSM Parameter Store` を使ってキーを注入する。Secrets Manager から読み出すサンプルは次フェーズで作成する。

- 期待される学び・成果物:
  - `template.yaml`（SAM テンプレ）の理解
  - `sam build` / `sam deploy --guided` による実デプロイ体験
  - AWS マネジメントコンソールで作成されたリソース（Lambda, API Gateway, IAM Role 等）の確認

## ✅ 次のアクション（提案）

1. 私が `feat/sam-deploy` ブランチを作り、プロジェクト用の `template.yaml` を作成してコミットします（Dockerなし前提） — これを希望する場合は「進めて」と伝えてください。\
2. デプロイ手順（`sam deploy --guided` の想定回答）を作成して案内します。\
3. デプロイ後に Secrets Manager を利用する方法に移行します（別タスク）。

---

学習メモは `docs/rules/learning-notes-guide.md` に従って作成しました。ファイル命名や構成はルール通りにしています。
